[[env]]
GIT_USERNAME = "9econds"

# -----------------------------------------------------------------------------

[tools]
"cargo:selene" = "latest"
ruff = "latest"
stylua = "latest"

# -----------------------------------------------------------------------------

[tasks.plug]
description = "Mount plug"
usage = '''
  arg "<plug>" help="Name of the plug to connect to"
  complete "plug" run="ls -l ~/.dotfiles | awk '$1 ~ /^d.*/ {print $NF}'"
'''
run = "./dots plug {{ arg(name='plug') }}"

[tasks.unplug]
description = "Unmount plug"
usage = '''
  arg "<plug>" help="Name of the plug to disconnect"
  complete "plug" run="ls -l ~/.dotfiles | awk '$1 ~ /^d.*/ {print $NF}'"
'''
run = "./dots unplug {{ arg(name='plug') }}"

# ============

[tasks."lua"]
description = "Run Lua routines"
depends = ['lua:*:*']

[tasks."lua:format:stylua"]
description = "Run Lua formatter"
usage = '''
  arg "<source>" help="Name of the file to process" default="." var=#true
  complete "source" run="fd -e lua -H"
'''
sources = [
  ".stylua.toml",
  "**/*.lua"
]
run = "stylua -a {{ arg(name='source') }}"

[tasks."lua:lint:selene"]
description = "Run Lua linter"
usage = '''
  arg "<source>" help="Name of the file to lint" default="." var=#true
  complete "source" run="fd -e lua -H"
'''
sources = [
  "selene.toml",
  "**/*.lua"
]
run = "selene {{ arg(name='source') }}"

# ============

[tasks."python"]
description = "Run Python routines"
run = [
  "mise tasks run 'python:*:*' dots",
  "fd -e py -H -X mise tasks run 'python:*:*'"
]

[tasks."python:lint:ruff"]
description = "Run Python linter"
usage = '''
  arg "<source>" help="Name of the file to lint" var=#true
  complete "source" run="echo dots; fd -e py -H"
'''
sources = [
  "ruff.toml",
  "dots",
  "**/*.py"
]
run = "ruff check {{ arg(name='source') }}"

[tasks."python:format:ruff"]
description = "Format Python with ruff"
usage = '''
  arg "<source>" help="Name of the file to lint" var=#true
  complete "source" run="echo dots; fd -e py -H"
'''
sources = [
  "ruff.toml",
  "dots",
  "**/*.py"
]
run = "ruff format {{ arg(name='source') }}"

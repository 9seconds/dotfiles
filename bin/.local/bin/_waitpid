#!/usr/bin/env fish
# vim: set sw=2 sts=2 ts=2

# Show the contents of a script with a given name

set this_script_path $(path resolve $(status --current-filename))
set this_script_name $(path basename $this_script_path)

function show_help
  echo "Usage: $this_script_name [-h/--help] [-d/--debug] [-n/--notify] ARG"
  echo
  echo 'Wait for PID to be finished.'
  echo
  echo 'Options:'
  echo '  -h, --help    Show this help message and exit'
  echo '  -d, --debug   Run in debug mode'
  echo '  -n, --notify  Notify it is done'
end

argparse 'h/help&' 'd/debug&' 'n/notify&' -- $argv
or begin
  show_help
  return 1
end

if set -q _flag_debug
  set fish_trace 1
end
if set -q _flag_help
  show_help
  return 0
end

if type -fq caffeine
  caffeinate -w $argv[1]
else if type -qf systemd-inhibit
  systemd-inhibit \
    --what=idle \
    --who=$this_script_name \
    --why="Wait for pid $argv[1]" \
    tail --pid=$argv[1] -f /dev/null
else
  tail --pid=$argv[1] -f /dev/null
end

_notify "Done" "$this_script_name $(string join -- ' ' $argv)"
